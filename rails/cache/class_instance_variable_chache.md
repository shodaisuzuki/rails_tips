# クラスインスタンス変数の注意

右辺の実行結果をキャッシュために以下の手法がよく使われると思います。

```
Class Foo
  def
    @foo ||= bar
  end
end
```

インスタンスメソッドの場合、インスタンス変数はFooクラスのオブジェクト毎に保持されます。
これをクラスメソッド内で使用する場合は注意が必要です。

```
Class Foo
  self.def
    @foo ||= bar
  end
end
```

クラスメソッド内でインスタンス変数はClassクラスのオブジェクト毎に保持され、
Classクラスのオブジェクトはアプリケーション起動時から同じものを使い続けます。
その為、DB問合せ結果をキャッシュしてしまったりすると、アプリケーション起動後DBに初めて問い合わせした値を保持し続けてしまう為、
その後別のリクエストでDBを更新しても、反映されないなどの問題が発生します。